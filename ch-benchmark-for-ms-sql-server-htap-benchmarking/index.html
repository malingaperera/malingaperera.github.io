<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="google-site-verification" content="_PLYlFzfO_lGMbNMlE69Ud5LJ2P-BhbJvR-3-_oXzIw"> <meta http-equiv="Permissions-Policy" content="interest-cohort=()"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>CH-BenCHmark for MS SQL Server - HTAP benchmarking | Romesh Malinga Perera</title> <meta name="author" content="R. Malinga Perera"> <meta name="description" content="CH-BenCHmark for MS SQL Server - HTAP benchmarking"> <meta name="keywords" content="R. Malinga Perera, AWS, Amazon, Researcher, University of Melbourne"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favi.png?04973ede2ae0fe2e2b3f25d362982959"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://www.malinga.me/ch-benchmark-for-ms-sql-server-htap-benchmarking/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">Romesh Malinga Perera</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">Blog</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/resume/">Resume</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">CH-BenCHmark for MS SQL Server - HTAP benchmarking</h1> <p class="post-meta">August 23, 2020</p> <p class="post-tags"> <a href="/2020"> <i class="fas fa-calendar fa-sm"></i> 2020 </a>   ·   <a href="/tag/benchmark"> <i class="fas fa-hashtag fa-sm"></i> benchmark</a>   <a href="/tag/sql-server"> <i class="fas fa-hashtag fa-sm"></i> sql-server</a>     ·   <a href="/category/database"> <i class="fas fa-tag fa-sm"></i> database</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/images/HTAP-benchmarking-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/images/HTAP-benchmarking-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/images/HTAP-benchmarking-1400.webp"></source> <img src="/assets/images/HTAP-benchmarking.png" class="img-fluid rounded z-depth-1 mx-auto d-block" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>There aren’t many benchmarks which allow you to test your systems against a hybrid OLTP and OLAP workloads. <a href="https://db.in.tum.de/research/projects/CHbenCHmark/index.shtml?lang=en" rel="external nofollow noopener" target="_blank">CH-BenCHmark</a> fills that gap by combining TPC-C and TPC-H. You can download the source from the linked site or you can use something like <a href="https://github.com/oltpbenchmark/oltpbench" rel="external nofollow noopener" target="_blank">OLTPBench</a> (a collection of benchmarks). However, the TPC-H modified queries are not written for SQL server. In this article, I will add the modified CH-BenCHmark OLAP queries for SQL Server.</p> <h4 id="query-1">Query 1</h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT OL_NUMBER,
       SUM(OL_QUANTITY) AS SUM_QTY,
       SUM(OL_AMOUNT) AS SUM_AMOUNT,
       AVG(OL_QUANTITY) AS AVG_QTY,
       AVG(OL_AMOUNT) AS AVG_AMOUNT,
       COUNT(*) AS COUNT_ORDER
FROM ORDER_LINE
WHERE OL_DELIVERY_D &gt; '2007-01-02 00:00:00.000'
GROUP BY OL_NUMBER
ORDER BY OL_NUMBER;
</code></pre></div></div> <h4 id="query-2">Query 2</h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT SU_SUPPKEY,
       SU_NAME,
       N_NAME,
       I_ID,
       I_NAME,
       SU_ADDRESS,
       SU_PHONE,
       SU_COMMENT
FROM ITEM, SUPPLIER, STOCK, NATION, REGION,
  (SELECT S_I_ID AS M_I_ID, MIN (S_QUANTITY) AS M_S_QUANTITY
   FROM STOCK,
        SUPPLIER,
        NATION,
        REGION
   WHERE (S_W_ID*S_I_ID) % 10000=SU_SUPPKEY
     AND SU_NATIONKEY=N_NATIONKEY
     AND N_REGIONKEY=R_REGIONKEY
     AND R_NAME LIKE 'EUROP%'
   GROUP BY S_I_ID) M
WHERE I_ID = S_I_ID
  AND (S_W_ID * S_I_ID) % 10000 = SU_SUPPKEY
  AND SU_NATIONKEY = N_NATIONKEY
  AND N_REGIONKEY = R_REGIONKEY
  AND I_DATA LIKE '%B'
  AND R_NAME LIKE 'EUROP%'
  AND I_ID=M_I_ID
  AND S_QUANTITY = M_S_QUANTITY
ORDER BY N_NAME,
         SU_NAME,
         I_ID;
</code></pre></div></div> <h4 id="query-3">Query 3</h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT OL_O_ID,
       OL_W_ID,
       OL_D_ID,
       SUM(OL_AMOUNT) AS REVENUE,
       O_ENTRY_D
FROM CUSTOMER,
     NEW_ORDER,
     OORDER,
     ORDER_LINE
WHERE C_STATE LIKE 'A%'
  AND C_ID = O_C_ID
  AND C_W_ID = O_W_ID
  AND C_D_ID = O_D_ID
  AND NO_W_ID = O_W_ID
  AND NO_D_ID = O_D_ID
  AND NO_O_ID = O_ID
  AND OL_W_ID = O_W_ID
  AND OL_D_ID = O_D_ID
  AND OL_O_ID = O_ID
  AND O_ENTRY_D &gt; '2007-01-02 00:00:00.000'
GROUP BY OL_O_ID,
         OL_W_ID,
         OL_D_ID,
         O_ENTRY_D
ORDER BY REVENUE DESC , O_ENTRY_D
</code></pre></div></div> <h4 id="query-4">Query 4</h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT O_OL_CNT,
       COUNT(*) AS ORDER_COUNT
FROM OORDER
WHERE EXISTS
    (SELECT *
     FROM ORDER_LINE
     WHERE O_ID = OL_O_ID
       AND O_W_ID = OL_W_ID
       AND O_D_ID = OL_D_ID
       AND OL_DELIVERY_D &gt;= O_ENTRY_D)
GROUP BY O_OL_CNT
ORDER BY O_OL_CNT
</code></pre></div></div> <h4 id="query-5">Query 5</h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT N_NAME,
       SUM(OL_AMOUNT) AS REVENUE
FROM CUSTOMER,
     OORDER,
     ORDER_LINE,
     STOCK,
     SUPPLIER,
     NATION,
     REGION
WHERE C_ID = O_C_ID
  AND C_W_ID = O_W_ID
  AND C_D_ID = O_D_ID
  AND OL_O_ID = O_ID
  AND OL_W_ID = O_W_ID
  AND OL_D_ID=O_D_ID
  AND OL_W_ID = S_W_ID
  AND OL_I_ID = S_I_ID
  AND (S_W_ID * S_I_ID) % 10000 = SU_SUPPKEY
  AND ASCII(SUBSTRING(C_STATE, 1, 1)) = SU_NATIONKEY
  AND SU_NATIONKEY = N_NATIONKEY
  AND N_REGIONKEY = R_REGIONKEY
  AND R_NAME = 'EUROPE'
  AND O_ENTRY_D &gt;= '2007-01-02 00:00:00.000'
GROUP BY N_NAME
ORDER BY REVENUE DESC;
</code></pre></div></div> <h4 id="query-6">Query 6</h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT SUM(OL_AMOUNT) AS REVENUE
FROM ORDER_LINE
WHERE OL_DELIVERY_D &gt;= '1999-01-01 00:00:00.000'
  AND OL_DELIVERY_D &lt; '2020-08-19 00:00:00.000'
  AND OL_QUANTITY BETWEEN 1 AND 100000
</code></pre></div></div> <h4 id="query-7">Query 7</h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT SU_NATIONKEY AS SUPP_NATION,
       SUBSTRING(C_STATE, 1, 1) AS CUST_NATION,
       YEAR(O_ENTRY_D) AS L_YEAR,
       SUM(OL_AMOUNT) AS REVENUE
FROM SUPPLIER,
     STOCK,
     ORDER_LINE,
     OORDER,
     CUSTOMER,
     NATION N1,
     NATION N2
WHERE OL_SUPPLY_W_ID = S_W_ID
  AND OL_I_ID = S_I_ID
  AND (S_W_ID * S_I_ID) % 10000 = SU_SUPPKEY
  AND OL_W_ID = O_W_ID
  AND OL_D_ID = O_D_ID
  AND OL_O_ID = O_ID
  AND C_ID = O_C_ID
  AND C_W_ID = O_W_ID
  AND C_D_ID = O_D_ID
  AND SU_NATIONKEY = N1.N_NATIONKEY
  AND ASCII(SUBSTRING(C_STATE, 1, 1)) = N2.N_NATIONKEY
  AND ((N1.N_NAME = 'GERMANY'
        AND N2.N_NAME = 'CAMBODIA')
       OR (N1.N_NAME = 'CAMBODIA'
           AND N2.N_NAME = 'GERMANY'))
GROUP BY SU_NATIONKEY,
         SUBSTRING(C_STATE, 1, 1),
         YEAR(O_ENTRY_D)
ORDER BY SU_NATIONKEY,
         CUST_NATION,
         L_YEAR
</code></pre></div></div> <h4 id="query-8">Query 8</h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT YEAR(O_ENTRY_D) AS L_YEAR,
       SUM(CASE WHEN N2.N_NAME = 'GERMANY' THEN OL_AMOUNT ELSE 0 END) / SUM(OL_AMOUNT) AS MKT_SHARE
FROM ITEM,
     SUPPLIER,
     STOCK,
     ORDER_LINE,
     OORDER,
     CUSTOMER,
     NATION N1,
     NATION N2,
     REGION
WHERE I_ID = S_I_ID
  AND OL_I_ID = S_I_ID
  AND OL_SUPPLY_W_ID = S_W_ID
  AND (S_W_ID * S_I_ID) % 10000 = SU_SUPPKEY
  AND OL_W_ID = O_W_ID
  AND OL_D_ID = O_D_ID
  AND OL_O_ID = O_ID
  AND C_ID = O_C_ID
  AND C_W_ID = O_W_ID
  AND C_D_ID = O_D_ID
  AND N1.N_NATIONKEY = ASCII(SUBSTRING(C_STATE, 1, 1))
  AND N1.N_REGIONKEY = R_REGIONKEY
  AND OL_I_ID &lt; 1000
  AND R_NAME = 'EUROPE'
  AND SU_NATIONKEY = N2.N_NATIONKEY
  AND I_DATA LIKE '%B'
  AND I_ID = OL_I_ID
GROUP BY YEAR(O_ENTRY_D)
ORDER BY L_YEAR;
</code></pre></div></div> <h4 id="query-9">Query 9</h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT N_NAME,
       YEAR(O_ENTRY_D) AS L_YEAR,
       SUM(OL_AMOUNT) AS SUM_PROFIT
FROM ITEM,
     STOCK,
     SUPPLIER,
     ORDER_LINE,
     OORDER,
     NATION
WHERE OL_I_ID = S_I_ID
  AND OL_SUPPLY_W_ID = S_W_ID
  AND (S_W_ID * S_I_ID) % 10000 = SU_SUPPKEY
  AND OL_W_ID = O_W_ID
  AND OL_D_ID = O_D_ID
  AND OL_O_ID = O_ID
  AND OL_I_ID = I_ID
  AND SU_NATIONKEY = N_NATIONKEY
  AND I_DATA LIKE '%BB'
GROUP BY N_NAME,
         YEAR(O_ENTRY_D)
ORDER BY N_NAME,
         L_YEAR DESC;
</code></pre></div></div> <h4 id="query-10">Query 10</h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT C_ID,
       C_LAST,
       SUM(OL_AMOUNT) AS REVENUE,
       C_CITY,
       C_PHONE,
       N_NAME
FROM CUSTOMER,
     OORDER,
     ORDER_LINE,
     NATION
WHERE C_ID = O_C_ID
  AND C_W_ID = O_W_ID
  AND C_D_ID = O_D_ID
  AND OL_W_ID = O_W_ID
  AND OL_D_ID = O_D_ID
  AND OL_O_ID = O_ID
  AND O_ENTRY_D &gt;= '2007-01-02 00:00:00.000'
  AND O_ENTRY_D &lt;= OL_DELIVERY_D
  AND N_NATIONKEY = ASCII(SUBSTRING(C_STATE, 1, 1))
GROUP BY C_ID,
         C_LAST,
         C_CITY,
         C_PHONE,
         N_NAME
ORDER BY REVENUE DESC;
</code></pre></div></div> <h4 id="query-11">Query 11</h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT s_i_id,
       sum(s_order_cnt) AS ordercount
FROM stock,
     supplier,
     nation
WHERE (s_w_id * s_i_id) % 10000 = su_suppkey
  AND su_nationkey = n_nationkey
  AND n_name = 'Germany'
GROUP BY s_i_id HAVING sum(s_order_cnt) &gt;
  (SELECT sum(s_order_cnt) * .005
   FROM stock,
        supplier,
        nation
   WHERE (s_w_id * s_i_id) % 10000 = su_suppkey
     AND su_nationkey = n_nationkey
     AND n_name = 'Germany')
ORDER BY ordercount DESC;
</code></pre></div></div> <h4 id="query-12">Query 12</h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT o_ol_cnt,
       sum(CASE WHEN o_carrier_id = 1
           OR o_carrier_id = 2 THEN 1 ELSE 0 END) AS high_line_count,
       sum(CASE WHEN o_carrier_id &lt;&gt; 1
           AND o_carrier_id &lt;&gt; 2 THEN 1 ELSE 0 END) AS low_line_count
FROM oorder,
     order_line
WHERE ol_w_id = o_w_id
  AND ol_d_id = o_d_id
  AND ol_o_id = o_id
  AND o_entry_d &lt;= ol_delivery_d
  AND ol_delivery_d &lt; '2020-09-01 00:00:00.000'
GROUP BY o_ol_cnt
ORDER BY o_ol_cnt;
</code></pre></div></div> <h4 id="query-13">Query 13</h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT c_count,
       count(*) AS custdist
FROM
  (SELECT c_id,
          count(o_id) AS c_count
   FROM customer
   LEFT OUTER JOIN oorder ON (c_w_id = o_w_id
                              AND c_d_id = o_d_id
                              AND c_id = o_c_id
                              AND o_carrier_id &gt; 8)
   GROUP BY c_id) AS c_orders
GROUP BY c_count
ORDER BY custdist DESC, c_count DESC;
</code></pre></div></div> <h4 id="query-14">Query 14</h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT (100.00 * sum(CASE WHEN i_data LIKE 'PR%' THEN ol_amount ELSE 0 END) / (1 + sum(ol_amount))) AS promo_revenue
FROM order_line,
     item
WHERE ol_i_id = i_id
  AND ol_delivery_d &gt;= '2007-01-02 00:00:00.000'
  AND ol_delivery_d &lt; '2020-09-02 00:00:00.000';
</code></pre></div></div> <h4 id="query-15">Query 15</h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT su_suppkey,
       su_name,
       su_address,
       su_phone,
       total_revenue
FROM supplier, revenue0
WHERE su_suppkey = supplier_no
    AND total_revenue = (select max(total_revenue) from revenue0)
ORDER BY su_suppkey;
</code></pre></div></div> <h4 id="query-16">Query 16</h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT i_name,
       substring(i_data, 1, 3) AS brand,
       i_price,
       count(DISTINCT ((s_w_id * s_i_id) % 10000)) AS supplier_cnt
FROM stock,
     item
WHERE i_id = s_i_id
  AND i_data NOT LIKE 'zz%'
  AND ((s_w_id * s_i_id) % 10000 NOT IN
    (SELECT su_suppkey
     FROM supplier
     WHERE su_comment LIKE '%bad%'))
GROUP BY i_name,
         substring(i_data, 1, 3),
         i_price
ORDER BY supplier_cnt DESC;
</code></pre></div></div> <h4 id="query-17">Query 17</h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT SUM (ol_amount) / 2.0 AS avg_yearly
FROM order_line,
  (SELECT i_id, AVG (ol_quantity) AS a
   FROM item,
        order_line
   WHERE i_data LIKE '%b'
     AND ol_i_id = i_id
   GROUP BY i_id) t
WHERE ol_i_id = t.i_id
  AND ol_quantity &lt; t.a;
</code></pre></div></div> <h4 id="query-18">Query 18</h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT c_last,
       c_id,
       o_id,
       o_entry_d,
       o_ol_cnt,
       sum(ol_amount) AS amount_sum
FROM customer,
     oorder,
     order_line
WHERE c_id = o_c_id
  AND c_w_id = o_w_id
  AND c_d_id = o_d_id
  AND ol_w_id = o_w_id
  AND ol_d_id = o_d_id
  AND ol_o_id = o_id
GROUP BY o_id,
         o_w_id,
         o_d_id,
         c_id,
         c_last,
         o_entry_d,
         o_ol_cnt HAVING sum(ol_amount) &gt; 200
ORDER BY amount_sum DESC, o_entry_d;
</code></pre></div></div> <h4 id="query-19">Query 19</h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT sum(ol_amount) AS revenue
FROM order_line,
     item
WHERE (ol_i_id = i_id
       AND i_data LIKE '%a'
       AND ol_quantity &gt;= 1
       AND ol_quantity &lt;= 10
       AND i_price BETWEEN 1 AND 400000
       AND ol_w_id IN (1,
                       2,
                       3))
  OR (ol_i_id = i_id
      AND i_data LIKE '%b'
      AND ol_quantity &gt;= 1
      AND ol_quantity &lt;= 10
      AND i_price BETWEEN 1 AND 400000
      AND ol_w_id IN (1,
                      2,
                      4))
  OR (ol_i_id = i_id
      AND i_data LIKE '%c'
      AND ol_quantity &gt;= 1
      AND ol_quantity &lt;= 10
      AND i_price BETWEEN 1 AND 400000
      AND ol_w_id IN (1,
                      5,
                      3));
</code></pre></div></div> <h4 id="query-20">Query 20</h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT su_name,
       su_address
FROM supplier,
     nation
WHERE su_suppkey IN
    (SELECT s_i_id * s_w_id % 10000
     FROM stock
     INNER JOIN item ON i_id = s_i_id
     INNER JOIN order_line ON ol_i_id = s_i_id
     WHERE ol_delivery_d &gt; '2010-05-23 12:00:00'
       AND i_data LIKE 'co%'
     GROUP BY s_i_id,
              s_w_id,
              s_quantity HAVING 2*s_quantity &gt; sum(ol_quantity))
  AND su_nationkey = n_nationkey
  AND n_name = 'Germany'
ORDER BY su_name;
</code></pre></div></div> <h4 id="query-21">Query 21</h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT su_name,
       count(*) AS numwait
FROM supplier,
     order_line l1,
     oorder,
     stock,
     nation
WHERE ol_o_id = o_id
  AND ol_w_id = o_w_id
  AND ol_d_id = o_d_id
  AND ol_w_id = s_w_id
  AND ol_i_id = s_i_id
  AND (s_w_id * s_i_id) % 10000 = su_suppkey
  AND l1.ol_delivery_d &gt; o_entry_d
  AND NOT EXISTS
    (SELECT *
     FROM order_line l2
     WHERE l2.ol_o_id = l1.ol_o_id
       AND l2.ol_w_id = l1.ol_w_id
       AND l2.ol_d_id = l1.ol_d_id
       AND l2.ol_delivery_d &gt; l1.ol_delivery_d)
  AND su_nationkey = n_nationkey
  AND n_name = 'Germany'
GROUP BY su_name
ORDER BY numwait DESC, su_name;
</code></pre></div></div> <h4 id="query-22">Query 22</h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT substring(c_state, 1, 1) AS country,
count(*) AS numcust,
sum(c_balance) AS totacctbal
FROM customer
WHERE substring(c_phone, 1, 1) IN ('1',
                              '2',
                              '3',
                              '4',
                              '5',
                              '6',
                              '7')
  AND c_balance &gt;
    (SELECT avg(c_balance)
     FROM customer
     WHERE c_balance &gt; 0.00
       AND substring(c_phone, 1, 1) IN ('1',
                                   '2',
                                   '3',
                                   '4',
                                   '5',
                                   '6',
                                   '7'))
  AND NOT EXISTS
    (SELECT *
     FROM oorder
     WHERE o_c_id = c_id
       AND o_w_id = c_w_id
       AND o_d_id = c_d_id)
GROUP BY substring(c_state, 1, 1)
ORDER BY substring(c_state,1,1);
</code></pre></div></div> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/reading-and-understanding-the-storm-ui-storm-ui-explained/">Reading and Understanding the Storm UI [Storm UI explained]</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/suzuki-wagonr-hybrid-stingray-fuse-design-identifying-and-changing-the-blown-fuse/">Suzuki WagonR Hybrid (Stingray) – Fuse design (Identifying and changing the blown fuse)</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/application-aware-sharding-for-a-mysql-database/">Application Aware Sharding for a MySQL Database</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/evolution-of-a-data-platform/">Evolution of a Data Platform</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/tpc-h-htap-workload-skewed-datasets/">TPC-H HTAP: INSERT, UPDATE, DELETE Queries for Skewed Datasets</a> </li> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2026 R. Malinga Perera. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-DZBX7PNSL8"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-DZBX7PNSL8");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>