<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="google-site-verification" content="_PLYlFzfO_lGMbNMlE69Ud5LJ2P-BhbJvR-3-_oXzIw"> <meta http-equiv="Permissions-Policy" content="interest-cohort=()"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Developing “Keep Me Logged In” / “Remember me” / "Stay signed in"option | Romesh Malinga Perera</title> <meta name="author" content="R. Malinga Perera"> <meta name="description" content="Developing “Keep Me Logged In” / “Remember me” / " stay signed in> <meta name="keywords" content="R. Malinga Perera, AWS, Amazon, Researcher, University of Melbourne"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favi.png?04973ede2ae0fe2e2b3f25d362982959"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://malingaperera.github.io/developing-keep-me-logged-in-remember-me-option/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">Romesh Malinga Perera</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">Blog</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/resume/">Resume</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Developing “Keep Me Logged In” / “Remember me” / "Stay signed in"option</h1> <p class="post-meta">January 21, 2015</p> <p class="post-tags"> <a href="/2015"> <i class="fas fa-calendar fa-sm"></i> 2015 </a>   ·   <a href="/tag/authentication"> <i class="fas fa-hashtag fa-sm"></i> authentication</a>     ·   <a href="/category/front-end"> <i class="fas fa-tag fa-sm"></i> front-end</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/images/stay-signed-in-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/images/stay-signed-in-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/images/stay-signed-in-1400.webp"></source> <img src="/assets/images/stay-signed-in.png" class="img-fluid rounded z-depth-1 mx-auto d-block" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>I recently had to develop above feature couple of times in past few weeks. I came across several issues while implementing this feature. Most of these issues did not have any thing do with the programming language I used (i.e. they are not implementation related issues) but had to do with the concept of development (i.e. design issues). As these are concept level issues, I can make this article more abstract and do not have to couple with a programming language I used (PHP). However will show some code segments in PHP + pseudo, which will be very basic and can be easily translated to any other language.</p> <p>First, I must emphasize that this method is based on one basic idea. “DO NOT PUT USER DATA IN COOKIE”, even in encrypted format. If you are OK with putting some user data in the cookie, because you believe that encryption cannot be broken or the information is useless to an attacker, jump to the “Not Recommended but Easy Solution” section at the end of the article</p> <h2 id="recommended-solution">Recommended Solution</h2> <h3 id="why-we-should-not-put-user-data-in-the-cookie">Why we should not put user data in the cookie</h3> <p>Let us say that we used md5 hashing. Even though it is hard to break, modern day computers are good at it. Especially with the recent development in GPUs, this is much easier. In future, it is going to be even more powerful and you will need to change your code when it gets to that stage. One-way to make it bit more secure is by adding more randomness in to the user information using a salt. However best way is not to save any user information on the browser.</p> <h3 id="setting-the-cookie">Setting the Cookie</h3> <p>We need to get two things done when user returns. However, we should not store any user detail in order to do that</p> <ul> <li>We need to validate the token</li> <li>Identify the user, who is related to the token</li> </ul> <p>First, I will generate a good random value with high entropy (if you are not comfortable with how to do that, just search on it and you will come across so many better ways of doing that). I used below,</p> <p>$token = uniqid(mt_rand(), true);</p> <p>Then we will store the token in the DB, which will return an Id to identify the saved information. This Id will be used to get the $token and $userId (some king of an identification that will help us to identify the user)</p> <table> <tbody> <tr> <td>I will save 3 values in the cookie with “</td> <td> </td> <td>” separating each value. The cookie value will look like below. Mind here I have used a CRYPT_KEY, which only I know. Make sure this value is truly random and very strong.</td> </tr> </tbody> </table> <p>$someId = storeInDB ($tocken, $userId); $cookieValue = $someId . ‘||’ . $token . ‘||’ . hash_hmac(‘ripemd160’, $token, CRYPT_KEY); setcookie(‘rememberme’, $cookieValue);</p> <h3 id="reading-the-cookie">Reading the Cookie</h3> <p>This is what happens when the user comes back, as you can remember we have to get two things done</p> <ul> <li>We need to validate the token</li> <li>Identify the user related to token</li> </ul> <table> <tbody> <tr> <td>First, we need to get the string divided by “</td> <td> </td> <td>”</td> </tr> </tbody> </table> <table> <tbody> <tr> <td>list ($someId, $token, $encryptedToken) = explode(‘</td> <td> </td> <td>’, $_COOKIE[‘rememberme’])</td> </tr> </tbody> </table> <p>Use the $someId and do a db call to get the userId and token ($userID, $tockenFromDB)</p> <p>To validate token below expression should be true. If it is TRUE, identify the user and log him in</p> <p>if ($encryptedToken == hash_hmac(‘ripemd160’, $token, CRYPT_KEY)) { If ($token == $tockenFromDB) { $user = getUserById($userId); login($user); } }</p> <h2 id="not-recommended-but-easy-solution">Not Recommended But Easy Solution</h2> <p>If you are OK with putting some user data in the cookie, either because you believe that encryption cannot be broken or the user information is useless to a attacker, You can use below method. Just get the cookie value as below, here $userEmail can be any user identification.</p> <table> <tbody> <tr> <td>$cookieValue = $userEmail . ‘</td> <td> </td> <td>’ . hash_hmac(‘ripemd160’, $userEmail, CRYPT_KEY);</td> </tr> </tbody> </table> <p>When user returns,</p> <table> <tbody> <tr> <td>list ($userEmail, $encryptedUserEmail) = explode(‘</td> <td> </td> <td>’, $_COOKIE[‘rememberme’])</td> </tr> </tbody> </table> <p>Verify if hash_hmac(‘ripemd160’, $userEmail, CRYPT_KEY) == $encryptedUserEmail.</p> <p>Then login the user with $userEmail</p> <p>This method removes all database calls and token generation steps so this will be lot faster than the above method. If you have any problems ask them in comments.</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/reading-and-understanding-the-storm-ui-storm-ui-explained/">Reading and Understanding the Storm UI [Storm UI explained]</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/application-aware-sharding-for-a-mysql-database/">Application Aware Sharding for a MySQL Database</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/evolution-of-a-data-platform/">Evolution of a Data Platform</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/continuous-data-loading-from-mysql-to-hive-using-tungsten/">Continuous data loading from MySQL to Hive [Using Tungsten]</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/toastmasters-round-robin-session-round-robin-master-role-and-new-ideas/">Toastmasters Round Robin session, Round Robin Master Role and New ideas</a> </li> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2023 R. Malinga Perera. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-DZBX7PNSL8"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-DZBX7PNSL8");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>