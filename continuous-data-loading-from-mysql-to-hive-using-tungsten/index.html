<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="google-site-verification" content="_PLYlFzfO_lGMbNMlE69Ud5LJ2P-BhbJvR-3-_oXzIw"> <meta http-equiv="Permissions-Policy" content="interest-cohort=()"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Continuous data loading from MySQL to Hive [Using Tungsten] | Romesh Malinga Perera</title> <meta name="author" content="R. Malinga Perera"> <meta name="description" content="Continuous data loading from MySQL to Hive [Using Tungsten]"> <meta name="keywords" content="R. Malinga Perera, AWS, Amazon, Researcher, University of Melbourne"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favi.png?04973ede2ae0fe2e2b3f25d362982959"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://malingaperera.github.io/continuous-data-loading-from-mysql-to-hive-using-tungsten/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">Romesh Malinga Perera</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">Blog</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/resume/">Resume</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Continuous data loading from MySQL to Hive [Using Tungsten]</h1> <p class="post-meta">May 31, 2015</p> <p class="post-tags"> <a href="/2015"> <i class="fas fa-calendar fa-sm"></i> 2015 </a>   ·   <a href="/tag/mysql"> <i class="fas fa-hashtag fa-sm"></i> mysql</a>   <a href="/tag/tungsten"> <i class="fas fa-hashtag fa-sm"></i> tungsten</a>   <a href="/tag/hive"> <i class="fas fa-hashtag fa-sm"></i> hive</a>     ·   <a href="/category/database"> <i class="fas fa-tag fa-sm"></i> database</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/images/mysql-to-hive1-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/images/mysql-to-hive1-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/images/mysql-to-hive1-1400.webp"></source> <img src="/assets/images/mysql-to-hive1.jpg" class="img-fluid rounded z-depth-1 mx-auto d-block" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h2 id="introduction-skip-if-needed">Introduction [Skip If needed]</h2> <h3 id="what-is-hive">What is Hive</h3> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/images/hive_logo-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/images/hive_logo-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/images/hive_logo-1400.webp"></source> <img src="/assets/images/hive_logo.png" class="img-fluid rounded z-depth-1 mx-auto d-block" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>“The Apache Hive™ data warehouse software facilitates querying and managing large datasets residing in distributed storage. Hive provides a mechanism to project structure onto this data and query the data using a SQL-like language called HiveQL. At the same time this language also allows traditional map/reduce programmers to plug in their custom mappers and reducers when it is inconvenient or inefficient to express this logic in HiveQL.”_</p> <p>~ <a href="https://hive.apache.org/" rel="external nofollow noopener" target="_blank">Hive official site</a></p> <h3 id="why-hive">Why Hive</h3> <p>Hive is been used in lot of Major companies including Facebook and Google. Hive excels at real time processing of large amount of data. Any use case that talks about querying large amounts of data in near real time can be benefited by hive. Hive is superior in availability, scalability and manageability. Hive now have capability to store complicated schemas and advance operations like table alteration. If you are a user stuck with a MySQL warehouse and want to get your data into hive for some real time complex querying, it will not be a hard job to replicate the same RDBMS schema in the hive. Following are some real world use cases of hive</p> <ul> <li>Bizo: We use Hive for reporting and ad hoc queries.</li> <li>Chitika: for data mining and analysis</li> <li>CNET: for data mining, log analysis and ad hoc queries</li> <li>Digg: data mining, log analysis, R&amp;D, reporting/analytics</li> <li>Grooveshark: user analytics, dataset cleaning, machine learning R&amp;D.</li> <li>Hi5: analytics, machine learning, social graph analysis.</li> <li>HubSpot: to serve near real-time web analytics.</li> <li>Last.fm: for various ad hoc queries.</li> <li>Trending Topics: for log data normalization and building sample data sets for trend detection R&amp;D.</li> <li>VideoEgg: analyze all the usage data</li> </ul> <p>Hope you have enough motivation now let us move into the business.</p> <h2 id="process">Process</h2> <h2 id="continuous-data-loading-from-mysql-to-hive">Continuous data loading from MySQL to Hive</h2> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/images/mysql_hdfs_integration-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/images/mysql_hdfs_integration-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/images/mysql_hdfs_integration-1400.webp"></source> <img src="/assets/images/mysql_hdfs_integration.png" class="img-fluid rounded z-depth-1 mx-auto d-block" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <ol> <li>Use Tungsten to get the MySQL bin logs CSV files</li> <li>Use DDLScan tool to create the Hive Staging and base table structures</li> <li>Use Map-Reduce job to load base tables from the staging tables.</li> <li>[Optional] Use bc tool to compare MySQL table and hive table</li> <li>Setup continuous loading</li> </ol> <h2 id="scope">Scope</h2> <p>Here I will no talk about setting up tungsten replication and assume that you have setup the tungsten replication and you have csv files in a hadoop file location. We will talk about rest of the process in detail. I will use the code found in the scripts found in the https://github.com/continuent/continuent-tools-hadoop GIT location in above process. I will not go into the Map-Reduce jobs and how it works.</p> <h2 id="prerequisites">Prerequisites</h2> <ul> <li>Install and configure tungsten server and client</li> <li>Get a git clone https://github.com/continuent/continuent-tools-hadoop.git</li> <li>Create a user account in MySQL, Hadoop and OS (i created a user hive with password password) to be used in the process</li> <li>Setup hive and create a DB to load data</li> <li>[Optional] Setup hue</li> </ul> <h2 id="detailed-description">Detailed Description</h2> <h3 id="step-1---creating-staging-and-base-tables-in-the-hive">Step 1 - Creating Staging and Base tables in the Hive</h3> <p>We will use the DDLScan tool in the continuent/tungsten/tungsten-replicator/bin/ to create the Staging and Base table structures in the hive. Go to the folder, which you can find the ddlscan scripts. Below 2 commands will create the Staging and Base table structures. We can use the load-reduce-check found in the cloned git repo for everything but you can use the below scripts as this is most of the time a onetime process.</p> <h4 id="creating-the-staging-tables">Creating the staging tables</h4> <table> <tbody> <tr> <td>ddlscan -user hive -url jdbc:mysql:thin://localhost:3306/DB_NAME -pass password -template ddl-mysql-hive-0.10-staging.vm -db DB_NAME -opt hdfsStagingDir /path/to/hadoop/csv</td> <td>hive</td> </tr> </tbody> </table> <h4 id="creating-the-base-tables">Creating the base tables</h4> <table> <tbody> <tr> <td>ddlscan -user hive -url jdbc:mysql:thin://localhost:3306/DB_NAME -pass password -template ddl-mysql-hive-0.10.vm -db DB_NAME</td> <td>hive</td> </tr> </tbody> </table> <p>After you have ran the above scripts. You will see that there are two sets of tables. For each MySQL table (call it TABLE), there will be 2 hive tables. One with the same name (TABLE) and one with ‘Staging_XXX_’ prefix (Staging_XXX_TABLE). In addition, if you browse data you will see that staging tables already have data whereas base tables are empty. As we are yet to load data to hive tables how can staging tables are already loaded. This is a simple representation of the CSV files itself. Staging tables shows the CSV files data in the table structure. Here we cannot do querying as we do in the base table.</p> <p>You can use the load-reduce-check script to do the same work as above. Below command can perform the same job performed by above two commands.</p> <p>load-reduce-check -U jdbc:mysql:thin://localhost:3306/DB_NAME -D /path/to/hadoop/csv -r /path/to/continuent/dir -s DB_NAME -u tungsten -p password -v –no-compare –no-map-reduce –no-materialize –no-meta –no-sqoop</p> <p>[NOTE] load-reduce-check is a complete script from table creation to data loading. We can skip steps in the script and in the above command; I have skipped almost everything other than table creation. In both occasions hive DB should be there to create tables.</p> <h3 id="step-2---loading-data-to-base-tables">Step 2 - Loading data to base tables</h3> <p>Here we will run the load-reduce-check with skipping unwanted steps to get the data loaded to the base tables. This will run the Map-Reduce against each staging table and will populate the base tables.</p> <p>load-reduce-check -U jdbc:mysql:thin://localhost:3306/DISCO -D /user/tungsten/staging/alpha -r /ebs/continuent -s DISCO -u tungsten -p password -v –no-base-ddl –no-compaer –no-staging-ddl –no-base-ddl</p> <h3 id="step-3---setting-up-continuous-loading">Step 3 - Setting up continuous loading</h3> <p>When you complete the step 2 you will be able to browse data in the base tables. Now we have to setup continuous loading. We can run the step 2 again and again but it will run the map reduce on the full dataset again. So we need to run the map-reduce job on the delta and append it to the hive table. Below i have listed process I have used to load data continuously to hive</p> <ol> <li>Stop tungsten replication</li> <li>Run Map-reduce</li> <li>Move the CSV files</li> <li>Start tungsten replication</li> </ol> <h2 id="conclusion">Conclusion</h2> <p>To summarize, I have discussed the continuous data loading to hive from mysql. We used the scripts found in https://github.com/continuent/continuent-tools-hadoop.git git location to create tables and load data. If you have, any more issues when following the process please comment below. I ran into lot of permission issues while following this process and most of them can be solved by creating a user with one username in all the places (hive, hadoop, OS).</p> <h4 id="help-load-reduce-check">[HELP] load-reduce-check</h4> <ul> <li>   -D, –staging-dir String         Directory within Hadoop for staging data (default=/user/tungsten/staging)</li> <li>   -l, –log String                 Log file for detailed output</li> <li>   -m, –metadata String           Table metadata JSON file (/tmp/meta.json)</li> <li>   -P, –schema-prefix String       Prefix for schema names (defaults to replication service</li> <li>   -p, –password String           MySQL password</li> <li>   -q, –sqoop-dir String           Directory within Hadoop for Sqooped table data (default=/user/tungsten/sqoop)</li> <li>   -r, –replicator String         Replicator home (/opt/continuent)</li> <li>   -S, –service String             Replicator service that generated data</li> <li>   -s, –schema String             DBMS schema</li> <li>   -t, –table String               Table within schema (default=all)</li> <li>   -U, –url String                 MySQL DBMS JDBC url</li> <li>   -u, –user String               MySQL user</li> <li>   -v, –verbose                   Print verbose output</li> <li>       –hive-ext-libs String       Location of Hive JDBC jar files</li> <li>       –[no-]base-ddl             Load base table ddl</li> <li>       –[no-]compare               Compare to source data</li> <li>       –[no-]map-reduce           Materialize view for tables (deprecated)</li> <li>       –[no-]materialize           Materialize view for tables</li> <li>       –[no-]meta                 Generate metadata for tables</li> <li>       –[no-]sqoop                 Generate Sqoop commands to provision data</li> <li>       –[no-]staging-ddl           Load staging table ddl</li> <li>   -h, –help                       Displays help</li> </ul> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/reading-and-understanding-the-storm-ui-storm-ui-explained/">Reading and Understanding the Storm UI [Storm UI explained]</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/application-aware-sharding-for-a-mysql-database/">Application Aware Sharding for a MySQL Database</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/evolution-of-a-data-platform/">Evolution of a Data Platform</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/microsoft-sql-server-2016-database-with-imdb-2013-dataset/">Microsoft SQL Server 2016 Database with IMDB 2013 Dataset</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/suzuki-wagonr-hybrid-stingray-fuse-design-identifying-and-changing-the-blown-fuse/">Suzuki WagonR Hybrid (Stingray) – Fuse design (Identifying and changing the blown fuse)</a> </li> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2023 R. Malinga Perera. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-DZBX7PNSL8"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-DZBX7PNSL8");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>