<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="4.3.2">Jekyll</generator><link href="https://malingaperera.github.io/feed.xml" rel="self" type="application/atom+xml"/><link href="https://malingaperera.github.io/" rel="alternate" type="text/html" hreflang="en"/><updated>2023-11-11T04:25:20+00:00</updated><id>https://malingaperera.github.io/feed.xml</id><title type="html">Romesh Malinga Perera</title><subtitle>Human | Engineer | Researcher </subtitle><entry><title type="html">Updated 2022 Nov - Water Bill Calculator – Sri Lanka</title><link href="https://malingaperera.github.io/water-bill-calculator-sri-lanka/" rel="alternate" type="text/html" title="Updated 2022 Nov - Water Bill Calculator – Sri Lanka"/><published>2022-11-11T21:01:00+00:00</published><updated>2022-11-11T21:01:00+00:00</updated><id>https://malingaperera.github.io/water-bill-calculator-sri-lanka</id><content type="html" xml:base="https://malingaperera.github.io/water-bill-calculator-sri-lanka/"><![CDATA[<div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/water-bill-calculator-sri-lanka/water-bill-calculator-sri-lanka-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/water-bill-calculator-sri-lanka/water-bill-calculator-sri-lanka-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/water-bill-calculator-sri-lanka/water-bill-calculator-sri-lanka-1400.webp"/> <img src="/assets/img/water-bill-calculator-sri-lanka/water-bill-calculator-sri-lanka.png" class="img-fluid rounded z-depth-1 mx-auto d-block" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p>Most people got huge water bills after some time due to COVID-19. I wanted to double-check the calculation because the amount was somewhat big. Unlucky I didn’t find any online calculator that gets the job done (there was one in the waterboard, but it has a maximum limit of 60 days). So I went with the default option, Excel. I thought of sharing the excel workbook I used as It might be helpful to others. I really don’t know how the VAT calculation is done, so I used 15%. (Thanks to Madura for the suggested edit)</p> <p>Download the <a href="https://malingaperera.github.io/assets/pdf/water-bill-calculator-sri-lanka/Water-Bill-Calculator-8.xlsx">Water Bill Calculator</a></p> <p>These are the supporting document I used.</p> <p>Download <a href="https://malingaperera.github.io/assets/pdf/water-bill-calculator-sri-lanka/Water-Tariff-2294-51_English.pdf">Gazette for water tariff</a></p>]]></content><author><name></name></author><category term="other"/><category term="life"/><category term="other"/><summary type="html"><![CDATA[Updated 2022 Nov - Water Bill Calculator – Sri Lanka]]></summary></entry><entry><title type="html">SQL Server Snapshot Creation Error - “All files must be specified for database snapshot creation”</title><link href="https://malingaperera.github.io/sql-server-snapshot-creation-error-all-files-must-be-specified-for-database-snapshot-creation/" rel="alternate" type="text/html" title="SQL Server Snapshot Creation Error - “All files must be specified for database snapshot creation”"/><published>2021-10-04T00:00:00+00:00</published><updated>2021-10-04T00:00:00+00:00</updated><id>https://malingaperera.github.io/sql-server-snapshot-creation-error-all-files-must-be-specified-for-database-snapshot-creation</id><content type="html" xml:base="https://malingaperera.github.io/sql-server-snapshot-creation-error-all-files-must-be-specified-for-database-snapshot-creation/"><![CDATA[<div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/images/All-files-must-be-specified-for-database-snapshot-creation.-1-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/images/All-files-must-be-specified-for-database-snapshot-creation.-1-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/images/All-files-must-be-specified-for-database-snapshot-creation.-1-1400.webp"/> <img src="/assets/images/All-files-must-be-specified-for-database-snapshot-creation.-1.png" class="img-fluid rounded z-depth-1 mx-auto d-block" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p>There are several reasons where you will get this error, but I’m going to talk about the one I faced and can be fixed in seconds. I was working with an IMDB dataset. The reason for my error was a database rename. I created the database initially with the name “IMDB” and later renamed it to “IMDB_001”.</p> <p>Command:</p> <p><code class="language-plaintext highlighter-rouge">CREATE DATABASE IMDB_001_snapshot ON ( NAME = IMDB_001, FILENAME ='--path--\IMDB_001_snapshot.ss' ) AS SNAPSHOT OF IMDB_001;</code></p> <p>Error: All files must be specified for database snapshot creation. Missing the file “IMDB”. (5127) (SQLExecDirectW)’)</p> <p>Fix (Using SSMS):</p> <p>Right-click on the database &gt; Properties &gt; (left menu)Files &gt; Rename the file logical names to current database name (in my case to IMDB_001)</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/images/All-files-must-be-specified-for-database-snapshot-creation-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/images/All-files-must-be-specified-for-database-snapshot-creation-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/images/All-files-must-be-specified-for-database-snapshot-creation-1400.webp"/> <img src="/assets/images/All-files-must-be-specified-for-database-snapshot-creation.jpg" class="img-fluid rounded z-depth-1 mx-auto d-block" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div>]]></content><author><name></name></author><category term="database"/><category term="microsoft"/><category term="sql-server"/><summary type="html"><![CDATA[SQL Server Snapshot Creation Error - "All files must be specified for database snapshot creation"]]></summary></entry><entry><title type="html">VS Code Won’t Open After Unplanned Restart (Failed to deserialize the V8 snapshot blob)</title><link href="https://malingaperera.github.io/vs-code-wont-open-after-unplanned-restart-failed-to-deserialize-the-v8-snapshot-blob/" rel="alternate" type="text/html" title="VS Code Won’t Open After Unplanned Restart (Failed to deserialize the V8 snapshot blob)"/><published>2021-02-11T21:01:00+00:00</published><updated>2021-02-11T21:01:00+00:00</updated><id>https://malingaperera.github.io/vs-code-wont-open-after-unplanned-restart-failed-to-deserialize-the-v8-snapshot-blob</id><content type="html" xml:base="https://malingaperera.github.io/vs-code-wont-open-after-unplanned-restart-failed-to-deserialize-the-v8-snapshot-blob/"><![CDATA[<div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/vs_code_wont_open/vs_code_wont_open-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/vs_code_wont_open/vs_code_wont_open-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/vs_code_wont_open/vs_code_wont_open-1400.webp"/> <img src="/assets/img/vs_code_wont_open/vs_code_wont_open.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p>The visual studio was running fine in my machine till an unplanned restart happened. Soon after restart VS didn’t open giving me the below error. I reinstalled the Visual Studio Code without uninstalling which fixed the issue. In addition, it started without any loss to previous plugins and open projects. Error</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Fatal error in , line 0
Failed to deserialize the V8 snapshot blob. This can mean that the snapshot blob file is corrupted or missing.
FailureMessage Object: 00000071D3DFF2C0
1: 00007FF60A57E91F node::Buffer::New+130911
2: 00007FF60A3F7CDA IsSandboxedProcess+1850986
3: 00007FF608E1D798 v8::Isolate::Initialize+744
4: 00007FF60A3FD1A0 uv_mutex_unlock+21184
5: 00007FF607A28793 std::__1::__vector_base &gt;::__end_cap+102515
6: 00007FF607AE56C8 v8::internal::JSMemberBase::JSMemberBase+54872
7: 00007FF6079513A0 Ordinal0+5024
8: 00007FF60D6FDB02 uv_random+18066594
9: 00007FFB77EF4034 BaseThreadInitThunk+20
10: 00007FFB781F3691 RtlUserThreadStart+33
</code></pre></div></div>]]></content><author><name></name></author><category term="programming"/><category term="coding"/><category term="programming"/><category term="tools"/><summary type="html"><![CDATA[VS Code Won’t Open After Unplanned Restart (Failed to deserialize the V8 snapshot blob)]]></summary></entry><entry><title type="html">PostgreSQL – BULK INSERTING from a delimited file, Most common errors in Windows</title><link href="https://malingaperera.github.io/postgresql-bulk-inserting-from-a-delimited-file-most-common-errors-in-windows/" rel="alternate" type="text/html" title="PostgreSQL – BULK INSERTING from a delimited file, Most common errors in Windows"/><published>2021-01-20T00:00:00+00:00</published><updated>2021-01-20T00:00:00+00:00</updated><id>https://malingaperera.github.io/postgresql-bulk-inserting-from-a-delimited-file-most-common-errors-in-windows</id><content type="html" xml:base="https://malingaperera.github.io/postgresql-bulk-inserting-from-a-delimited-file-most-common-errors-in-windows/"><![CDATA[<div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/images/postgresql-bulk-inserting-from-a-delimited-file-most-common-errors-in-windows-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/images/postgresql-bulk-inserting-from-a-delimited-file-most-common-errors-in-windows-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/images/postgresql-bulk-inserting-from-a-delimited-file-most-common-errors-in-windows-1400.webp"/> <img src="/assets/images/postgresql-bulk-inserting-from-a-delimited-file-most-common-errors-in-windows.png" class="img-fluid rounded z-depth-1 mx-auto d-block" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p>PostgreSQL alternative for MS SQL Server BULK INSERT is the equally simple <a href="https://www.postgresql.org/docs/current/sql-copy.html">COPY</a> command. In this article, we are going to take a step by step look at how to use this and possible errors. So I tried below command, which is completely correct. I faced a couple of issues when fixed it worked fine.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>COPY part FROM '...Desktop\TPCH_001\pg_part.tbl' WITH (DELIMITER  '|')
</code></pre></div></div> <h2 id="errors"><strong>Errors</strong></h2> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ERROR: could not open file "file.tbl" for reading: Permission denied.
HINT:  COPY FROM instructs the PostgreSQL server process to read a file.  You may want a client-side facility such as psql's \copy. 
SQL state: 42501
</code></pre></div></div> <p>To resolve this error, you need to update the permission of the file so that PostgreSQL can read them. Get to the folder/file, right-click and get to properties. Go to the Security tab. You need to add “Everyone” to the list. <a href="https://ourtechroom.com/tech/importing-csv-file-in-postgresql-table/">More info</a></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ERROR:  extra data after last expected column data ending with dilimiter
</code></pre></div></div> <p>This mean you have more columns the CSV than expected. As example you might have 4 column in CSV file and only 3 columns in the table. If it was other way around (table having more columns than file) we can define the needed columns in the query like below.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>COPY part (p_partkey, p_name, p_mfgr, p_brand, p_type, p_size, p_container, p_retailprice, p_comment) FROM '...Desktop\TPCH_001\pg_part.tbl' WITH (DELIMITER  '|')
</code></pre></div></div> <p>In my case, I used a simple python file to edit the files and write a new file. Yes! the only option is to edit the file. In my case I had a extra delimiter at the end of each line.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import os
from os import listdir
from os.path import isfile, join


data_location = "path_to_folder"
files = [f for f in listdir(data_location) if isfile(join(data_location, f))]
output_folder = "edited"

if not os.path.exists(os.path.join(data_location, output_folder)):
    os.makedirs(os.path.join(data_location, output_folder))

for file in files:
    with open(os.path.join(data_location, file), 'r+') as input_file, open(os.path.join(data_location, output_folder, file), 'w+') as output_file:
        line = input_file.readline()
        while line:
            output_file.write(line[:-2]+'\n')
            line = input_file.readline()
</code></pre></div></div> <p>After these 2 fixes, my command ran without any issue.</p>]]></content><author><name></name></author><category term="database"/><category term="microsoft"/><category term="postgresql"/><summary type="html"><![CDATA[PostgreSQL – BULK INSERTING from a delimited file, Most common errors in Windows]]></summary></entry><entry><title type="html">NetworkX visualization with Graphviz (Example)</title><link href="https://malingaperera.github.io/networkx-visualization-with-graphviz-example/" rel="alternate" type="text/html" title="NetworkX visualization with Graphviz (Example)"/><published>2020-07-19T21:01:00+00:00</published><updated>2020-07-19T21:01:00+00:00</updated><id>https://malingaperera.github.io/networkx-visualization-with-graphviz-example</id><content type="html" xml:base="https://malingaperera.github.io/networkx-visualization-with-graphviz-example/"><![CDATA[<div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/networkx-visualization-with-graphviz-example/NetworkX_visualization_with_Graphviz_Example_thumb-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/networkx-visualization-with-graphviz-example/NetworkX_visualization_with_Graphviz_Example_thumb-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/networkx-visualization-with-graphviz-example/NetworkX_visualization_with_Graphviz_Example_thumb-1400.webp"/> <img src="/assets/img/networkx-visualization-with-graphviz-example/NetworkX_visualization_with_Graphviz_Example_thumb.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p>If you are trying to visualize a nice graph with NetworkX, you should be exhausted by now. After all, NetworkX only provides basic functionality for graph visualization. The main goal of NetworkX is to enable graph analysis. For everything other than basic visualization, it’s advisable to use a separate specialized library. In my case, I choose Graphviz. It’s simplistic to get an attractive visualization of a NetworkX graph with Graphviz. I’m taking a gradual start, but you may skip to <strong>“NetworkX with Graphviz”</strong> directly.</p> <p><br/></p> <h3 id="networkx-with-matplotlib">NetworkX with Matplotlib</h3> <p>Let’s start small, so we can see the issue here. I’m trying to plot a simple directed graph (more like a tree).</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import networkx as nx
import matplotlib.pyplot as plt

G = nx.DiGraph()
G.add_edges_from([('A', 'B'), ('A', 'C'), ('A', 'D'), ('E', 'D'), ('D', 'F'), ('E', 'C'), ('E', 'G'), ('B', 'H'), ('H', 'F')])
pos = nx.spring_layout(G)
nx.draw_networkx(G, pos)
plt.show()
</code></pre></div></div> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/networkx-visualization-with-graphviz-example/NetworkX_visualization_with_Graphviz_Example_2-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/networkx-visualization-with-graphviz-example/NetworkX_visualization_with_Graphviz_Example_2-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/networkx-visualization-with-graphviz-example/NetworkX_visualization_with_Graphviz_Example_2-1400.webp"/> <img src="/assets/img/networkx-visualization-with-graphviz-example/NetworkX_visualization_with_Graphviz_Example_2.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p>The main issue I had here was the layout. When the number of nodes increases, the layout becomes messy. And the none of the limited set of layouts seems to be working. So the first option is to use a graphviz layout without much change.</p> <p><br/></p> <h3 id="using-graphviz-layout-with-the-existing-plot">Using Graphviz layout with the existing plot</h3> <p>Here we are just trying to get a better layout without any change to the graph look and feel. Note that you need to install the Graphviz before going to next step. (download). With Windows, you can download the setup from the above page. For Ubuntu, you can easily install that with below command (Graphviz and some needed libraries)</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get install graphviz libgraphviz-dev pkg-config
</code></pre></div></div> <p>Then we use the Graphviz layout (I use the default one here) to generate the positions of the nodes. Here I have exported it as a png, rather than showing it.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pos = nx.nx_pydot.graphviz_layout(G)
nx.draw_networkx(G, pos)
plt.savefig('networkx_graph.png')
</code></pre></div></div> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/networkx-visualization-with-graphviz-example/NetworkX_visualization_with_Graphviz_Example_1-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/networkx-visualization-with-graphviz-example/NetworkX_visualization_with_Graphviz_Example_1-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/networkx-visualization-with-graphviz-example/NetworkX_visualization_with_Graphviz_Example_1-1400.webp"/> <img src="/assets/img/networkx-visualization-with-graphviz-example/NetworkX_visualization_with_Graphviz_Example_1.png" class="img-fluid rounded z-depth-2" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p>As you can see the layout already looks better. However if you want to take the full advantage/power of Graphviz, you need to convert this to a Graphviz graph.</p> <p><br/></p> <h3 id="networkx-with-graphviz">NetworkX with Graphviz</h3> <p>We can directly convert to a Graphviz graph. First, install pygraphviz. Then run the code.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install pygraphviz
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A = nx.nx_agraph.to_agraph(G)
A.layout()
A.draw('networkx_graph.png')
</code></pre></div></div> <p>You can use an intermediate dot file, if you are working with 2 applications or if you want to store the graph structure.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nx.drawing.nx_pydot.write_dot(p_graph, 'networkx_graph.png')
gv.render('dot', 'png', 'networkx_graph.png')
</code></pre></div></div> <p>Both of these will generate the following graph. You can do any modification as you wish (Documentation).</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/networkx-visualization-with-graphviz-example/NetworkX_visualization_with_Graphviz_Example_3-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/networkx-visualization-with-graphviz-example/NetworkX_visualization_with_Graphviz_Example_3-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/networkx-visualization-with-graphviz-example/NetworkX_visualization_with_Graphviz_Example_3-1400.webp"/> <img src="/assets/img/networkx-visualization-with-graphviz-example/NetworkX_visualization_with_Graphviz_Example_3.png" class="img-fluid rounded z-depth-3" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div>]]></content><author><name></name></author><category term="visualization"/><category term="graph"/><summary type="html"><![CDATA[NetworkX visualization with Graphviz (Example)]]></summary></entry><entry><title type="html">Index Physical Structure Example - Multi-column Non-Clustered Index with Includes</title><link href="https://malingaperera.github.io/index-physical-structure-example-multi-column-non-clustered-index-with-includes/" rel="alternate" type="text/html" title="Index Physical Structure Example - Multi-column Non-Clustered Index with Includes"/><published>2020-07-18T21:01:00+00:00</published><updated>2020-07-18T21:01:00+00:00</updated><id>https://malingaperera.github.io/index-physical-structure-example-multi-column-non-clustered-index-with-includes</id><content type="html" xml:base="https://malingaperera.github.io/index-physical-structure-example-multi-column-non-clustered-index-with-includes/"><![CDATA[<div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/physical_design_example_non_clustered_index_with_includes/physical_design_example_non_clustered_index_with_includes_1-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/physical_design_example_non_clustered_index_with_includes/physical_design_example_non_clustered_index_with_includes_1-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/physical_design_example_non_clustered_index_with_includes/physical_design_example_non_clustered_index_with_includes_1-1400.webp"/> <img src="/assets/img/physical_design_example_non_clustered_index_with_includes/physical_design_example_non_clustered_index_with_includes_1.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p>This article demonstrates the physical design of a multi-column non-clustered index with include-columns. Many examples on the internet only demonstrate the most simple version of an index with a single column. This article gives a proper view of an index with multiple columns through a simple example. Furthermore, you can see how the include-columns are stored, only at the leaf level of the tree.</p> <p>Here we use a simple table ‘People’ with 6 columns (ID, First Name, Last Name, Age, Sex, Address). We assume we already have a clustered index created on the ID column (it will be almost no difference if there is no clustered index as well, explained at the end). Now we are going to create the non-clustered index as defined below.</p> <p><code> CREATE NONCLUSTERED INDEX IX_NAME ON People <br/> (FirstName, LastName)<br/> INCLUDE (Age, Sex)<br/> GO<br/> </code></p> <p>Below diagram shows the structure of this non-clustered index.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/physical_design_example_non_clustered_index_with_includes/physical_design_example_non_clustered_index_with_includes-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/physical_design_example_non_clustered_index_with_includes/physical_design_example_non_clustered_index_with_includes-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/physical_design_example_non_clustered_index_with_includes/physical_design_example_non_clustered_index_with_includes-1400.webp"/> <img src="/assets/img/physical_design_example_non_clustered_index_with_includes/physical_design_example_non_clustered_index_with_includes.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Index Physical Structure Example; Multi-column Non-Clustered Index with Includes. </div> <p>In the example above we are searching for the name <b>“Malinga Perera”</b>. In the root level (level 2; note that, the level number starts from leaves) <b>‘Malinga’</b> should come after <b>‘Kain’</b> and before <b>‘Ophelia’</b>. So we go to page 583. In level 1 we see that (Malinga) ‘Perera’ should come between (Malinga) <b>‘Amad’</b> and (Malinga) <b>‘Sonu’</b>. So we move to page 1024, which is a leaf node. In this leaf node, we find <b>‘Malinga Perera’</b>. I had to add a lot of ‘Malinga’s to get the last name into the example :D.</p> <p>In the leaf level, we see the additional columns we added as include-columns. Include-columns have a lesser overhead compared to the index-columns. However, if we need anything else, like address, we have to go to the actual table (clustered index). We got clustered index key 17 from this leaf node. This should lead us to the full data row directly (through the clustered index, to be specific). If we had this non-clustered index on a heap (i.e. no clustered index) then the pointer will give us the RID (row ID). RID directly give the physical address of the data (file:page:row).</p>]]></content><author><name></name></author><category term="database"/><category term="indices"/><category term="multi-column"/><category term="non-clustered"/><category term="database"/><category term="physical-design-structure"/><summary type="html"><![CDATA[Index Physical Structure Example; Multi-column Non-Clustered Index with Includes]]></summary></entry><entry><title type="html">Suzuki WagonR 12v Car Battery Replacement (Sri Lanka) - Amaron</title><link href="https://malingaperera.github.io/suzuki-wagonr-12v-car-battery-replacement-sri-lanka-amaron/" rel="alternate" type="text/html" title="Suzuki WagonR 12v Car Battery Replacement (Sri Lanka) - Amaron"/><published>2020-05-16T00:00:00+00:00</published><updated>2020-05-16T00:00:00+00:00</updated><id>https://malingaperera.github.io/suzuki-wagonr-12v-car-battery-replacement-sri-lanka-amaron</id><content type="html" xml:base="https://malingaperera.github.io/suzuki-wagonr-12v-car-battery-replacement-sri-lanka-amaron/"><![CDATA[<div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/images/Suzuki-WagonR-12v-Car-battery-replacement-Sri-Lanka-Amaron-1-1024x472-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/images/Suzuki-WagonR-12v-Car-battery-replacement-Sri-Lanka-Amaron-1-1024x472-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/images/Suzuki-WagonR-12v-Car-battery-replacement-Sri-Lanka-Amaron-1-1024x472-1400.webp"/> <img src="/assets/images/Suzuki-WagonR-12v-Car-battery-replacement-Sri-Lanka-Amaron-1-1024x472.jpeg" class="img-fluid rounded z-depth-1 mx-auto d-block" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p>I recently had to change my car battery. This is after running 4.5 years with my original battery. I replaced the original with an Amaron battery for 13000 rupees (checked the images at the end). I thought someone might find this information helpful. </p> <p>I initially assumed that my battery was dead due to low mileage in last month (COVID restrictions). So, I tried jump-starting the car several times. After jump-starting, I always took it to a ride. Still, after 1-2 days it died. Then I was sure it’s an issue with my battery.</p> <p>If you are interested to know about jump starting a WagonR, this video will help (Sinhala): <a href="https://www.youtube.com/watch?v=043A-pv6y3Q">https://www.youtube.com/watch?v=043A-pv6y3Q</a></p> <p>With COVID restrictions, I didn’t have many choices. I called Lucksons Battery Sales Centre (<a href="https://www.facebook.com/lucksonsBSC/">https://www.facebook.com/lucksonsBSC/</a>) and they came to my home and did the replacement. I don’t know them enough to recommend, but the service was good.</p> <p>Some Images that might be of interest:</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/images/Suzuki%20WagonR%2012v%20Car%20battery%20replacement%20(Sri%20Lanka)%20-%20Amaron%20(2)-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/images/Suzuki%20WagonR%2012v%20Car%20battery%20replacement%20(Sri%20Lanka)%20-%20Amaron%20(2)-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/images/Suzuki%20WagonR%2012v%20Car%20battery%20replacement%20(Sri%20Lanka)%20-%20Amaron%20(2)-1400.webp"/> <img src="/assets/images/Suzuki%20WagonR%2012v%20Car%20battery%20replacement%20(Sri%20Lanka)%20-%20Amaron%20(2).jpeg" class="img-fluid rounded z-depth-1 mx-auto d-block" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/images/Suzuki%20WagonR%2012v%20Car%20battery%20replacement%20(Sri%20Lanka)%20-%20Amaron%20(3)-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/images/Suzuki%20WagonR%2012v%20Car%20battery%20replacement%20(Sri%20Lanka)%20-%20Amaron%20(3)-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/images/Suzuki%20WagonR%2012v%20Car%20battery%20replacement%20(Sri%20Lanka)%20-%20Amaron%20(3)-1400.webp"/> <img src="/assets/images/Suzuki%20WagonR%2012v%20Car%20battery%20replacement%20(Sri%20Lanka)%20-%20Amaron%20(3).jpeg" class="img-fluid rounded z-depth-1 mx-auto d-block" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/images/Suzuki%20WagonR%2012v%20Car%20battery%20replacement%20(Sri%20Lanka)%20-%20Amaron%20(4)-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/images/Suzuki%20WagonR%2012v%20Car%20battery%20replacement%20(Sri%20Lanka)%20-%20Amaron%20(4)-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/images/Suzuki%20WagonR%2012v%20Car%20battery%20replacement%20(Sri%20Lanka)%20-%20Amaron%20(4)-1400.webp"/> <img src="/assets/images/Suzuki%20WagonR%2012v%20Car%20battery%20replacement%20(Sri%20Lanka)%20-%20Amaron%20(4).jpeg" class="img-fluid rounded z-depth-1 mx-auto d-block" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/images/Suzuki%20WagonR%2012v%20Car%20battery%20replacement%20(Sri%20Lanka)%20-%20Amaron%20(5)-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/images/Suzuki%20WagonR%2012v%20Car%20battery%20replacement%20(Sri%20Lanka)%20-%20Amaron%20(5)-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/images/Suzuki%20WagonR%2012v%20Car%20battery%20replacement%20(Sri%20Lanka)%20-%20Amaron%20(5)-1400.webp"/> <img src="/assets/images/Suzuki%20WagonR%2012v%20Car%20battery%20replacement%20(Sri%20Lanka)%20-%20Amaron%20(5).jpeg" class="img-fluid rounded z-depth-1 mx-auto d-block" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/images/Suzuki%20WagonR%2012v%20Car%20battery%20replacement%20(Sri%20Lanka)%20-%20Amaron%20(7)-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/images/Suzuki%20WagonR%2012v%20Car%20battery%20replacement%20(Sri%20Lanka)%20-%20Amaron%20(7)-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/images/Suzuki%20WagonR%2012v%20Car%20battery%20replacement%20(Sri%20Lanka)%20-%20Amaron%20(7)-1400.webp"/> <img src="/assets/images/Suzuki%20WagonR%2012v%20Car%20battery%20replacement%20(Sri%20Lanka)%20-%20Amaron%20(7).jpeg" class="img-fluid rounded z-depth-1 mx-auto d-block" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p><br/></p> <h3 id="few-things-you-need-to-know-before-you-change-the-batteries">Few things you need to know before you change the batteries.</h3> <ul> <li>Check the manufacture date on the battery (ensure you pick the freshest available, try to get one that is manufactured within last 3 months)</li> <li>After reading many comments I felt that Amaron was good enough for the price. There is Original Suzuki Car Battery – Specially design for “Idling Stop” Cars, this is costlier than the Amaron one</li> </ul> <iframe src="https://www.facebook.com/plugins/post.php?href=https%3A%2F%2Fwww.facebook.com%2FSuzukiWagonRHybrid%2Fposts%2F771996916310353&amp;width=500" style="border:none;overflow:hidden" scrolling="no" allowtransparency="true" allow="encrypted-media" width="500" height="757" frameborder="0"></iframe>]]></content><author><name></name></author><category term="life"/><category term="other"/><category term="wagonr"/><summary type="html"><![CDATA[Suzuki WagonR 12v Car Battery Replacement (Sri Lanka) - Amaron]]></summary></entry><entry><title type="html">Microsoft SQL Server 2016 Database with IMDB 2013 Dataset</title><link href="https://malingaperera.github.io/microsoft-sql-server-2016-database-with-imdb-2013-dataset/" rel="alternate" type="text/html" title="Microsoft SQL Server 2016 Database with IMDB 2013 Dataset"/><published>2020-03-31T00:00:00+00:00</published><updated>2020-03-31T00:00:00+00:00</updated><id>https://malingaperera.github.io/microsoft-sql-server-2016-database-with-imdb-2013-dataset</id><content type="html" xml:base="https://malingaperera.github.io/microsoft-sql-server-2016-database-with-imdb-2013-dataset/"><![CDATA[<div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/images/Microsoft-SQL-Server-2016-Database-with-IMDB-2013-Dataset-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/images/Microsoft-SQL-Server-2016-Database-with-IMDB-2013-Dataset-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/images/Microsoft-SQL-Server-2016-Database-with-IMDB-2013-Dataset-1400.webp"/> <img src="/assets/images/Microsoft-SQL-Server-2016-Database-with-IMDB-2013-Dataset.png" class="img-fluid rounded z-depth-1 mx-auto d-block" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p>Recently I wanted to run the <a href="https://github.com/gregrahn/join-order-benchmark">JOB benchmark</a> for an experiment. This benchmark uses an <a href="http://homepages.cwi.nl/~boncz/job/imdb.tgz">IMDB dataset</a>, published in 2013. Initially, I had some trouble running the benchmark as it was designed for a PostgreSQL database. And the dataset was created in a UNIX system which can create issues when used in a Windows system. So I decided to share the exact steps you need to take to take in order to create a Microsoft SQL Server database with IMDB dataset. All the scripts used in the project can be found in this <a href="https://github.com/malingaperera/imdb_2013_sql_server_2016">Git repo</a>.</p> <h2 id="step-1-create-a-database-in-sql-server"><strong>Step 1</strong>: Create a database in SQL server.</h2> <p>I simply used SSMS for this but you are free to use any method that you are familiar with. If you want to specifically set the data and log locations for the data set you can use the below script. Replace the db_location with the right location for your system.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>USE master ;  
GO  
CREATE DATABASE IMDB  
ON   
( NAME = imdb_dat,  
    FILENAME = 'db_location\imdbdat.mdf',  
    SIZE = 1024MB,  
    MAXSIZE = UNLIMITED,  
    FILEGROWTH = 128MB )  
LOG ON  
( NAME = imdb_log,  
    FILENAME = 'db_location\imdblog.ldf',  
    SIZE = 1024MB,  
    MAXSIZE = 2048GB,  
    FILEGROWTH = 50MB ) ;  
GO 
</code></pre></div></div> <h2 id="step-2-create-tables"><strong>Step 2</strong>: Create Tables</h2> <p>Don’t use the script you find in the JOB benchmark or with the dataset. This script is created for PostgreSQL and will not work as it is for SQL Server. You can use the edited version below. Note that I have used limits for all the VARCHAR columns under 8000 length. This limit was based on the maximum length of each column. For columns with maximum length over 8000, I have used the VARCHAR(MAX) type.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE aka_name (
    id integer NOT NULL PRIMARY KEY,
    person_id integer NOT NULL,
    name varchar(255),
    imdb_index varchar(3),
    name_pcode_cf varchar(11),
    name_pcode_nf varchar(11),
    surname_pcode varchar(11),
    md5sum varchar(65)
);

CREATE TABLE aka_title (
    id integer NOT NULL PRIMARY KEY,
    movie_id integer NOT NULL,
    title varchar(600),
    imdb_index varchar(4),
    kind_id integer NOT NULL,
    production_year integer,
    phonetic_code varchar(5),
    episode_of_id integer,
    season_nr integer,
    episode_nr integer,
    note varchar(72),
    md5sum varchar(33)
);

CREATE TABLE cast_info (
    id integer NOT NULL PRIMARY KEY,
    person_id integer NOT NULL,
    movie_id integer NOT NULL,
    person_role_id integer,
    note varchar(1000),
    nr_order integer,
    role_id integer NOT NULL
);

CREATE TABLE char_name (
    id integer NOT NULL PRIMARY KEY,
    name varchar(500) NOT NULL,
    imdb_index varchar(2),
    imdb_id integer,
    name_pcode_nf varchar(5),
    surname_pcode varchar(5),
    md5sum varchar(33)
);

CREATE TABLE comp_cast_type (
    id integer NOT NULL PRIMARY KEY,
    kind varchar(32) NOT NULL
);

CREATE TABLE company_name (
    id integer NOT NULL PRIMARY KEY,
    name varchar(255) NOT NULL,
    country_code varchar(6),
    imdb_id integer,
    name_pcode_nf varchar(5),
    name_pcode_sf varchar(5),
    md5sum varchar(33)
);

CREATE TABLE company_type (
    id integer NOT NULL PRIMARY KEY,
    kind varchar(32)
);

CREATE TABLE complete_cast (
    id integer NOT NULL PRIMARY KEY,
    movie_id integer,
    subject_id integer NOT NULL,
    status_id integer NOT NULL
);

CREATE TABLE info_type (
    id integer NOT NULL PRIMARY KEY,
    info varchar(32) NOT NULL
);

CREATE TABLE keyword (
    id integer NOT NULL PRIMARY KEY,
    keyword varchar(100) NOT NULL,
    phonetic_code varchar(6)
);

CREATE TABLE kind_type (
    id integer NOT NULL PRIMARY KEY,
    kind varchar(15)
);

CREATE TABLE link_type (
    id integer NOT NULL PRIMARY KEY,
    link varchar(32) NOT NULL
);

CREATE TABLE movie_companies (
    id integer NOT NULL PRIMARY KEY,
    movie_id integer NOT NULL,
    company_id integer NOT NULL,
    company_type_id integer NOT NULL,
    note varchar(255)
);

CREATE TABLE movie_info_idx (
    id integer NOT NULL PRIMARY KEY,
    movie_id integer NOT NULL,
    info_type_id integer NOT NULL,
    info varchar(10) NOT NULL,
    note varchar(1)
);

CREATE TABLE movie_keyword (
    id integer NOT NULL PRIMARY KEY,
    movie_id integer NOT NULL,
    keyword_id integer NOT NULL
);

CREATE TABLE movie_link (
    id integer NOT NULL PRIMARY KEY,
    movie_id integer NOT NULL,
    linked_movie_id integer NOT NULL,
    link_type_id integer NOT NULL
);

CREATE TABLE name (
    id integer NOT NULL PRIMARY KEY,
    name varchar(125) NOT NULL,
    imdb_index varchar(9),
    imdb_id integer,
    gender varchar(1),
    name_pcode_cf varchar(5),
    name_pcode_nf varchar(5),
    surname_pcode varchar(5),
    md5sum varchar(33)
);

CREATE TABLE role_type (
    id integer NOT NULL PRIMARY KEY,
    role varchar(32) NOT NULL
);

CREATE TABLE title (
    id integer NOT NULL PRIMARY KEY,
    title varchar(350) NOT NULL,
    imdb_index varchar(5),
    kind_id integer NOT NULL,
    production_year integer,
    imdb_id integer,
    phonetic_code varchar(5),
    episode_of_id integer,
    season_nr integer,
    episode_nr integer,
    series_years varchar(49),
    md5sum varchar(33)
);

CREATE TABLE movie_info (
    id integer NOT NULL PRIMARY KEY,
    movie_id integer NOT NULL,
    info_type_id integer NOT NULL,
    info varchar(MAX) NOT NULL,
    note varchar(500)
);

CREATE TABLE person_info (
    id integer NOT NULL PRIMARY KEY,
    person_id integer NOT NULL,
    info_type_id integer NOT NULL,
    info varchar(MAX) NOT NULL,
    note varchar(500)
);
</code></pre></div></div> <h2 id="step-3-convert-data-files-to-a-sql-serverwindows-friendly-version">Step 3: Convert data files to a SQL server/Windows-friendly version</h2> <p>Extract the downloaded zip file (I used 7-zip and had to extract it twice to access the files). Seems like these files were created in UNIX system and there are differences in the escaping and the line ending. I run the following python code to edit the files. It creates the edited files in a separate folder called ‘edited’ inside the original folder. Replace the data_location with the right location for your system. Make sure you have only data files (csv) in the data location, nothing else.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import os
from os.path import isfile, join, exists

imdb_data_location = 'data_location'
os.chdir(imdb_data_location)
only_files = [ f for f in os.listdir('.') if isfile(join('.', f)) ]
if not exists('edited'):
    os.makedirs('edited')
for file in only_files:
    with open(file, "r", encoding='utf-8') as ori:
        with open(f"edited\{file}", "w", encoding='utf-8') as dest:
            for line in ori:
                dest.write(line.replace('\\\\', '#$#$').replace('\\"', '""').replace('#$#$', '\\'))
</code></pre></div></div> <h2 id="step-4-load-data-using-bulk-load">Step 4: Load data using Bulk load</h2> <p>Now I’m going to use the SQL Server bulk insert to insert the data into the tables. Replace the <data location=""> with the right location for your system. You don't have to set the `ROWTERMINATOR`, `FIELDTERMINATOR` or the`FIELDQUOTE`, as we have defined the format as CSV.</data></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BULK INSERT aka_name FROM 'data_location\edited\aka_name.csv' WITH (FORMAT='CSV', CODEPAGE = '65001')
BULK INSERT aka_title FROM 'data_location\edited\aka_title.csv' WITH (FORMAT='CSV', CODEPAGE = '65001')
BULK INSERT cast_info FROM 'data_location\edited\cast_info.csv' WITH (FORMAT='CSV', CODEPAGE = '65001')
BULK INSERT char_name FROM 'data_location\edited\char_name.csv' WITH (FORMAT='CSV', CODEPAGE = '65001')
BULK INSERT comp_cast_type FROM 'data_location\edited\comp_cast_type.csv' WITH (FORMAT='CSV', CODEPAGE = '65001')
BULK INSERT company_name FROM 'data_location\edited\company_name.csv' WITH (FORMAT='CSV', CODEPAGE = '65001')
BULK INSERT company_type FROM 'data_location\edited\company_type.csv' WITH (FORMAT='CSV', CODEPAGE = '65001')
BULK INSERT complete_cast FROM 'data_location\edited\complete_cast.csv' WITH (FORMAT='CSV', CODEPAGE = '65001')
BULK INSERT info_type FROM 'data_location\edited\info_type.csv' WITH (FORMAT='CSV', CODEPAGE = '65001')
BULK INSERT keyword FROM 'data_location\edited\keyword.csv' WITH (FORMAT='CSV', CODEPAGE = '65001')
BULK INSERT kind_type FROM 'data_location\edited\kind_type.csv' WITH (FORMAT='CSV', CODEPAGE = '65001')
BULK INSERT link_type FROM 'data_location\edited\link_type.csv' WITH (FORMAT='CSV', CODEPAGE = '65001')
BULK INSERT movie_companies FROM 'data_location\edited\movie_companies.csv' WITH (FORMAT='CSV', CODEPAGE = '65001')
BULK INSERT movie_info FROM 'data_location\edited\movie_info.csv' WITH (FORMAT='CSV', CODEPAGE = '65001')
BULK INSERT movie_info_idx FROM 'data_location\edited\movie_info_idx.csv' WITH (FORMAT='CSV', CODEPAGE = '65001')
BULK INSERT movie_keyword FROM 'data_location\edited\movie_keyword.csv' WITH (FORMAT='CSV', CODEPAGE = '65001')
BULK INSERT movie_link FROM 'data_location\edited\movie_link.csv' WITH (FORMAT='CSV', CODEPAGE = '65001')
BULK INSERT name FROM 'data_location\edited\name.csv' WITH (FORMAT='CSV', CODEPAGE = '65001')
BULK INSERT person_info FROM 'data_location\edited\person_info.csv' WITH (FORMAT='CSV', CODEPAGE = '65001')
BULK INSERT role_type FROM 'data_location\edited\role_type.csv' WITH (FORMAT='CSV', CODEPAGE = '65001')
BULK INSERT title FROM 'data_location\edited\title.csv' WITH (FORMAT='CSV', CODEPAGE = '65001')
</code></pre></div></div> <h2 id="step-5-optional-create-foreign-keys">Step 5 (Optional): Create Foreign Keys</h2> <p>Foreign keys specified in the JOB are not that clear for me. Some of them contradict with the dataset. I re-wrote them to SQL Server based on my understanding. JOB mention that these foreign keys are optional.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ALTER TABLE movie_companies ADD CONSTRAINT fk_company_id_movie_companies FOREIGN KEY(company_id) REFERENCES company_name(id);
ALTER TABLE movie_companies ADD CONSTRAINT fk_company_type_id_movie_companies FOREIGN KEY(company_type_id) REFERENCES company_type(id);
ALTER TABLE movie_info_idx ADD CONSTRAINT fk_info_type_id_movie_info_idx FOREIGN KEY(info_type_id) REFERENCES info_type(id);
ALTER TABLE movie_info ADD CONSTRAINT fk_info_type_id_movie_info FOREIGN KEY(info_type_id) REFERENCES info_type(id);
ALTER TABLE person_info ADD CONSTRAINT fk_info_type_id_person_info FOREIGN KEY(info_type_id) REFERENCES info_type(id);
ALTER TABLE movie_keyword ADD CONSTRAINT fk_keyword_id_movie_keyword FOREIGN KEY(keyword_id) REFERENCES keyword(id);
ALTER TABLE aka_title ADD CONSTRAINT fk_kind_id_aka_title FOREIGN KEY(kind_id) REFERENCES kind_type(id);
ALTER TABLE title ADD CONSTRAINT fk_kind_id_title FOREIGN KEY(kind_id) REFERENCES kind_type(id);
ALTER TABLE movie_link ADD CONSTRAINT fk_linked_movie_id_movie_link FOREIGN KEY(linked_movie_id) REFERENCES movie_info(id);
ALTER TABLE movie_link ADD CONSTRAINT fk_link_type_id_movie_link FOREIGN KEY(link_type_id) REFERENCES link_type(id);
-- ALTER TABLE aka_title ADD CONSTRAINT fk_movie_id_aka_title FOREIGN KEY(movie_id) REFERENCES movie_info(id);
ALTER TABLE cast_info ADD CONSTRAINT fk_movie_id_cast_info FOREIGN KEY(movie_id) REFERENCES movie_info(id);
ALTER TABLE complete_cast ADD CONSTRAINT fk_movie_id_complete_cast FOREIGN KEY(movie_id) REFERENCES movie_info(id);
ALTER TABLE movie_companies ADD CONSTRAINT fk_movie_id_movie_companies FOREIGN KEY(movie_id) REFERENCES movie_info(id);
ALTER TABLE movie_info_idx ADD CONSTRAINT fk_movie_id_movie_info_idx FOREIGN KEY(movie_id) REFERENCES movie_info(id);
ALTER TABLE movie_keyword ADD CONSTRAINT fk_movie_id_movie_keyword FOREIGN KEY(movie_id) REFERENCES movie_info(id);
ALTER TABLE movie_link ADD CONSTRAINT fk_movie_id_movie_link FOREIGN KEY(movie_id) REFERENCES movie_info(id);
-- ALTER TABLE aka_name ADD CONSTRAINT fk_person_id_aka_name FOREIGN KEY(person_id) REFERENCES person_info(id);
-- ALTER TABLE cast_info ADD CONSTRAINT fk_person_id_cast_info FOREIGN KEY(person_id) REFERENCES person_info(id);
ALTER TABLE cast_info ADD CONSTRAINT fk_role_id_cast_info FOREIGN KEY(role_id) REFERENCES role_type(id);
</code></pre></div></div> <h2 id="step-6-optional-truncate-long-columns">Step 6 (Optional): Truncate long columns</h2> <p>Some of you might not like to keep VARCHAR(MAX) columns as you cannot create non-clustered indexes on them. You can use the below scripts to truncate the columns and ALTER the table.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>UPDATE person_info
SET  info = LEFT(info, 7999)
WHERE LEN(info) &gt; 7999

ALTER TABLE person_info ALTER COLUMN info varchar(7999);

UPDATE movie_info
SET  info = LEFT(info, 7999)
WHERE LEN(info) &gt; 7999

ALTER TABLE movie_info ALTER COLUMN info varchar(7999);
</code></pre></div></div> <p>Next steps with running the JOB will be added soon…</p>]]></content><author><name></name></author><category term="database"/><category term="microsoft"/><category term="sql-server"/><category term="imdb"/><summary type="html"><![CDATA[Microsoft SQL Server 2016 Database with IMDB 2013 Dataset]]></summary></entry><entry><title type="html">Jaro–Winkler Similarity – How to correctly count the number of transpositions</title><link href="https://malingaperera.github.io/jaro-winkler-similarity-how-to-correctly-count-the-number-of-transpositions/" rel="alternate" type="text/html" title="Jaro–Winkler Similarity – How to correctly count the number of transpositions"/><published>2020-01-15T21:01:00+00:00</published><updated>2020-01-15T21:01:00+00:00</updated><id>https://malingaperera.github.io/jaro%E2%80%93winkler-similarity%E2%80%93how-to-correctly-count-the-number-of-transpositions</id><content type="html" xml:base="https://malingaperera.github.io/jaro-winkler-similarity-how-to-correctly-count-the-number-of-transpositions/"><![CDATA[<div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/jaro_winkler_distance/jaro_winkler_distance-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/jaro_winkler_distance/jaro_winkler_distance-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/jaro_winkler_distance/jaro_winkler_distance-1400.webp"/> <img src="/assets/img/jaro_winkler_distance/jaro_winkler_distance.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p>Jaro–Winkler Similarity is a widely used similarity measure for checking the similarity between two strings. Being a similarity measure (not a distance measure), a higher value means more similar strings. You can read on basics and how it works on Wikipedia. It’s available in many places and I’m not going into that. However, none of these sites talks about how to correctly count the number of transpositions in complex situations.</p> <p>Transposition is defined as “matches which are not in the same position”. For a simple example like <strong>‘cart’</strong> vs <strong>‘cratec’</strong> it is obvious with 4 matches and 2 transpositions (‘r’ and ‘a’ are in not in the same position). But for <strong>‘xabcdxxxxxx’</strong> vs <strong>‘yaybycydyyyyyy’</strong> in the first look, all letters seem to be out of position but there are <strong>no transpositions</strong> (4 matches). For very similar <strong>‘xabcdxxxxxx’</strong> vs <strong>‘ydyaybycyyyyyy’</strong>, there are <strong>4 transpositions</strong> (4 matches). With these examples, it might not be trivial to count the number of transpositions.</p> <p>The main reason behind this complexity is we are looking at the whole word whereas we should be looking only at the matched part.</p> <p>Ex: <strong>‘xabcdxxxxxx’, ‘yaybycydyyyyyy’</strong> (get the matching letters and write it down)</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'xabcdxxxxxx': abcd'
yaybycydyyyyyy': abcd
</code></pre></div></div> <p>Now it’s clear that there are no transpositions</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'xabcdxxxxxx': abcd
' ydyaybycyyyyyy': dabc
</code></pre></div></div> <p>After extracting the matching letters, you can see each letter can be given an index. In the first word a-0, b-1, c-2, d-4. In the second word d-0, a-1, b-2, c-3. What you must check is how many of the matches are not having the same index. In this case, none of the matching letters has the same index. So, there are 4 transpositions. Once you understand this, it’s very trivial.</p> <p>You can find code for Jaro-Winkler here: https://rosettacode.org/wiki/Jaro_distance. You can use it to check if your calculations are correct.</p>]]></content><author><name></name></author><category term="algorithms"/><category term="algorithms"/><summary type="html"><![CDATA[Jaro–Winkler Similarity – How to correctly count the number of transpositions]]></summary></entry><entry><title type="html">PostgreSQL – How to get the total index size used by each table in a database</title><link href="https://malingaperera.github.io/postgresql-how-to-get-the-total-index-size-used-by-each-table-in-a-database/" rel="alternate" type="text/html" title="PostgreSQL – How to get the total index size used by each table in a database"/><published>2020-01-15T21:01:00+00:00</published><updated>2020-01-15T21:01:00+00:00</updated><id>https://malingaperera.github.io/postgresql-how-to-get-the-total-index-size-used-by-each-table-in-a-database</id><content type="html" xml:base="https://malingaperera.github.io/postgresql-how-to-get-the-total-index-size-used-by-each-table-in-a-database/"><![CDATA[<div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/postgresql-how-to-get-the-total-index-size-used-by-each-table-in-a-database/postgresql-how-to-get-the-total-index-size-used-by-each-table-in-a-database-480.webp"/> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/postgresql-how-to-get-the-total-index-size-used-by-each-table-in-a-database/postgresql-how-to-get-the-total-index-size-used-by-each-table-in-a-database-800.webp"/> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/postgresql-how-to-get-the-total-index-size-used-by-each-table-in-a-database/postgresql-how-to-get-the-total-index-size-used-by-each-table-in-a-database-1400.webp"/> <img src="/assets/img/postgresql-how-to-get-the-total-index-size-used-by-each-table-in-a-database/postgresql-how-to-get-the-total-index-size-used-by-each-table-in-a-database.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p>As per the documentation, To get the total size of all indexes attached to a table, you use the function. The pg_indexes_size() function accepts the OID or table name as the argument and returns the total disk space used by all indexes attached to that table.</p> <p>We will use this funcion to get the index sizes of each table in the database.</p> <p><code> select relname as table_name, <br/> pg_size_pretty(pg_indexes_size(relid)) as index_size <br/> from pg_catalog.pg_statio_user_tables; <br/> </code></p>]]></content><author><name></name></author><category term="database"/><category term="indices"/><category term="postgresql"/><summary type="html"><![CDATA[PostgreSQL – How to get the total index size used by each table in a database]]></summary></entry></feed>