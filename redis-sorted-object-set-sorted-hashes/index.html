<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="google-site-verification" content="_PLYlFzfO_lGMbNMlE69Ud5LJ2P-BhbJvR-3-_oXzIw"> <meta http-equiv="Permissions-Policy" content="interest-cohort=()"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Redis Sorted Object Set (Sorted Hashes) | Romesh Malinga Perera</title> <meta name="author" content="R. Malinga Perera"> <meta name="description" content="Redis Sorted Object Set (Sorted Hashes)"> <meta name="keywords" content="R. Malinga Perera, AWS, Amazon, Researcher, University of Melbourne"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favi.png?04973ede2ae0fe2e2b3f25d362982959"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://malingaperera.github.io/redis-sorted-object-set-sorted-hashes/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">Romesh Malinga Perera</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">Blog</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/resume/">Resume</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Redis Sorted Object Set (Sorted Hashes)</h1> <p class="post-meta">April 4, 2016</p> <p class="post-tags"> <a href="/2016"> <i class="fas fa-calendar fa-sm"></i> 2016 </a>   ·   <a href="/tag/redis"> <i class="fas fa-hashtag fa-sm"></i> redis</a>   <a href="/tag/cache"> <i class="fas fa-hashtag fa-sm"></i> cache</a>   <a href="/tag/key-value"> <i class="fas fa-hashtag fa-sm"></i> key-value</a>     ·   <a href="/category/database"> <i class="fas fa-tag fa-sm"></i> database</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/redis-sorted-object-set-sorted-hashes/redis-sorted-object-set-sorted-hashes1-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/redis-sorted-object-set-sorted-hashes/redis-sorted-object-set-sorted-hashes1-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/redis-sorted-object-set-sorted-hashes/redis-sorted-object-set-sorted-hashes1-1400.webp"></source> <img src="/assets/img/redis-sorted-object-set-sorted-hashes/redis-sorted-object-set-sorted-hashes1.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>We all know that the best way to store objects in Redis is through, Redis hashes. Redis sorted sets are used to keep a sorted set with a given score for each value. What if we need a sorted set of objects? What we need is a <strong>“Sorted set of Objects”</strong>, which Redis does not support by default. We came up with a hybrid, simple data structure that allows sorted objects using <strong>Redis Hashes</strong> and <strong>Redis Sorted sets</strong>.</p> <p><br></p> <h3 id="use-of-redis-hashes">Use of Redis Hashes</h3> <p>Here we will keep an object as a Redis hash. Think of a simple object with several values as shown below.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>TICKET1 {     
    MERCHANT_ID: 0123456789,     
    TIME_STAMP: 00000000000,     
    SALE: 12.32 
}
</code></pre></div></div> <p>This will be saved in the Redis</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HMSET TICKET1 MERCHANT_ID "0123456789" TIME_STAMP "00000000000" SALE "12.32"
</code></pre></div></div> <p>When we need to edit an existing value and add a new value it can be done below</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Adding a new value
HSET TICKET1 DISCOUNT "0.60"
 
// Set Multiple Values
HMSET TICKET1 DISCOUNT "0.50" SALE "12.60"
 
// Set single Value
HSET TICKET1 SALE "12.50"
 
// RESULT
TICKET1 {
    MERCHANT_ID: 0123456789,
    TIME_STAMP: 00000000000,
    SALE: 12.50,
    DISCOUNT: 0.50
}
</code></pre></div></div> <p>Getting full map and some selected value</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Get the full object
HGETALL TICKET1

1) "MERCHANT_ID" 
2) "0123456789" 
3) "TIME_STAMP" 
4) "00000000000" 
...   

// Get set of selected subset of values 
HMGET TICKET1 MERCHANT_ID SALE   
1) "0123456789" 
2) "12.50"   

// get a single value 
HGET DISCOUNT   
1) "0.50"
</code></pre></div></div> <p>Whole map or items can be deleted</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Delete one field
HDEL TICKET1 SALE
 
// Delete whole object
DEL TICKET1
</code></pre></div></div> <p>There is some more commands in the Redis hash that can help us in this process</p> <table> <thead> <tr> <th>Command</th> <th>Action</th> </tr> </thead> <tbody> <tr> <td>HEXISTS</td> <td>Check for item</td> </tr> <tr> <td>HINCRBY</td> <td>Add to integer value</td> </tr> <tr> <td>HINCRBYFLOAT</td> <td>Add to float value</td> </tr> <tr> <td>HKEYS</td> <td>Return all keys</td> </tr> <tr> <td>HLEN</td> <td>Get number of items</td> </tr> <tr> <td>HSCAN</td> <td>Iterate items</td> </tr> <tr> <td>HSETNX</td> <td>Set item if doesn’t exist</td> </tr> <tr> <td>HVALS</td> <td>Return all values</td> </tr> </tbody> </table> <p><br></p> <h3 id="use-of-redis-sorted-sets">Use of Redis Sorted Sets</h3> <p>As we said above we need to search with time values and in-order searches. This cannot be done alone by Redis hashes. Here we keep a list of all keys in the Redis hashes as a sorted set. This allow us to get all the maps that came after some time stamp. or between two time stamps. Other than that this allows us to search under topics (EX: get all TICKETS after 00000001 time stamp)</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ZADD TICKETS 1459746182 "TICKET1"
ZADD TICKETLINES 1459746192 "TICKETLINE1"
ZADD TICKETLINES 1459746222 "TICKETLINE2"
ZADD TICKETS 1459746282 "TICKET2"
ZADD TICKETS 1459746382 "TICKET3"
</code></pre></div></div> <p>Get items under one topic within a given time range</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ZRANGE TICKETS 1459746282 -1
1) "TICKET2"
2) "TICKET3"
</code></pre></div></div> <p>There is some more commands in the Redis hash that can help us in this process</p> <table> <thead> <tr> <th>Command</th> <th>Action</th> </tr> </thead> <tbody> <tr> <td>ZCARD</td> <td>Get number of items</td> </tr> <tr> <td>ZCOUNT</td> <td>Number of items within score range</td> </tr> <tr> <td>ZINCRBY</td> <td>Add to score</td> </tr> <tr> <td>ZLEXCOUNT</td> <td>Lexicographical range count</td> </tr> <tr> <td>ZRANGE</td> <td>Get items within rank range</td> </tr> <tr> <td>ZLEXRANGE</td> <td>Get items within lexicographical range</td> </tr> <tr> <td>ZRANGEBYSCORE</td> <td>Get items within score range</td> </tr> <tr> <td>ZRANK</td> <td>Get item rank</td> </tr> <tr> <td>ZREM</td> <td>Remove item(s)</td> </tr> <tr> <td>ZREMRANGEBYLEX</td> <td>Remove items within lexicographical range</td> </tr> <tr> <td>ZREMRANGEBYRANK</td> <td>Remove items within rank range</td> </tr> <tr> <td>ZREMRANGEBYSCORE</td> <td>Remove items within score range</td> </tr> <tr> <td>ZREVRANGE</td> <td>ZRANGE in reverse order</td> </tr> <tr> <td>ZREVRANGEBYSCORE</td> <td>ZRANGEBYSCORE in reverse order</td> </tr> <tr> <td>ZREVRANK</td> <td>ZRANK in reverse order</td> </tr> <tr> <td>ZSCAN</td> <td>Iterate items</td> </tr> <tr> <td>ZSCORE</td> <td>Get item score</td> </tr> <tr> <td>ZUNIONSTORE</td> <td>Store union</td> </tr> </tbody> </table> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/networkx-visualization-with-graphviz-example/">NetworkX visualization with Graphviz (Example)</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/index-physical-structure-example-multi-column-non-clustered-index-with-includes/">Index Physical Structure Example - Multi-column Non-Clustered Index with Includes</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/jaro-winkler-similarity-how-to-correctly-count-the-number-of-transpositions/">Jaro–Winkler Similarity – How to correctly count the number of transpositions</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/postgresql-how-to-get-the-total-index-size-used-by-each-table-in-a-database/">PostgreSQL – How to get the total index size used by each table in a database</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/vs-code-wont-open-after-unplanned-restart-failed-to-deserialize-the-v8-snapshot-blob/">VS Code Won’t Open After Unplanned Restart (Failed to deserialize the V8 snapshot blob)</a> </li> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2023 R. Malinga Perera. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-DZBX7PNSL8"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-DZBX7PNSL8");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>